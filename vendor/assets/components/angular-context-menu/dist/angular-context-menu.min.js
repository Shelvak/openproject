angular.module("ng-context-menu",[]).factory("ngContextMenu",["$q","$http","$compile","$templateCache","$animate","$rootScope","$controller",function(t,e,n,o,r,a,i){return function(l){function u(t,e,n){return this.target=t,h&&e&&f(e),m.then(function(t){return $||c(t,e),n&&$.css(n),$})}function c(t,e){if(x=angular.element(l.container||document.body),$=angular.element(t),0===$.length)throw new Error("The template contains no elements; you need to wrap text nodes");r.enter($,x),h=a.$new(),e&&f(e);var o=i(v,{$scope:h});d&&(h[d]=o),n($)(h)}function f(t){for(var e in t)h[e]=t[e]}function p(t){$&&$.css(t)}function s(){var e=t.defer();return $?(r.leave($,function(){h.$destroy(),e.resolve()}),this.target&&this.target.focus(),$=null):e.resolve(),e.promise}function g(){return!!$}if(!(!l.template^!l.templateUrl))throw new Error("Expected context menu to have exacly one of either `template` or `templateUrl`");var m,h,v=(l.template,l.controller||angular.noop),d=l.controllerAs,$=null,x=null;if(l.template){var y=t.defer();y.resolve(l.template),m=y.promise}else m=e.get(l.templateUrl,{cache:o}).then(function(t){return t.data});return{open:u,close:s,active:g,reposition:p}}}]).directive("hasContextMenu",["$injector","$window","$parse","$timeout","$animate",function(t,e,n,o,r){return{restrict:"A",link:function(n,o,a){function i(t){var e={},n=angular.element(t),o=n[0].getBoundingClientRect();return e.top=o.top,e.left=o.left,e}function l(t,e){var n={};return n.offsetY=e.top-t.top,n.offsetX=e.left-t.left,n}function u(t){var e=i(t.target),n=p(t),o=$.open(t.target,x,s(t));o.then(function(t){angular.element(t).trap(),r.enter(t,document.body,t,function(){c(t,n)})}),v=t.target,d=l(e,n)}function c(t,n){var o=angular.element(e),r={top:o.scrollTop(),left:o.scrollLeft()};r.right=r.left+o.width(),r.bottom=r.top+o.height();var a=t.offset();a.right=a.left+t.outerWidth(),a.bottom=a.top+t.outerHeight(),r.right<a.right&&t.css("left",n.left-t.outerWidth()),r.bottom<a.bottom&&t.css("top",n.top-t.outerHeight())}function f(){$.close()}function p(t){var e={};if(t.pageX&&t.pageY)e.top=Math.max(t.pageY,0),e.left=Math.max(t.pageX,0);else{var n=angular.element(t.target)[0].getBoundingClientRect();e.top=Math.max(n.bottom,0),e.left=Math.max(n.left,0)}return e}function s(t){var e=p(t);return e.top+="px",e.left+="px",e}function g(t){t.preventDefault(),t.stopPropagation(),n.$apply(function(){u(t)})}function m(){n.$apply(function(){f()})}function h(t){$.active()&&2!==t.button&&m()}var v,d,$=t.get(a.target),x={},y=angular.element(e),b=a.triggerOnEvent||"contextmenu";if(a.locals){var w=a.locals.split(",").map(function(t){return t.trim()});angular.forEach(w,function(t){x[t]=n[t]})}o.bind(b,function(t){g(t)}),o.bind("keyup",function(t){121===t.keyCode&&t.shiftKey&&t.altKey&&($.active()||g(t))}),y.bind("click",h),y.bind(b,h),y.bind("keyup",function(t){$.active()&&27===t.keyCode&&m()}),y.on("resize",function(){if(v){var t=i(v),e={top:t.top+d.offsetY,left:t.left+d.offsetX};$.reposition(e),lastTargetPosition=t}})}}}]);